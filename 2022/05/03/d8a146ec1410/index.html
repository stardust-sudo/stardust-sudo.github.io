<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="robots" content="index, follow"><title>变量、流程控制与游标MySQL笔记 • stardust's blog</title><meta name="description" content="变量、流程控制与游标MySQL笔记 - stardust"><link rel="icon" href="/favicon.svg"><link rel="stylesheet" href="https://unpkg.com/nanoreset@3.0.1/nanoreset.min.css"><link rel="stylesheet" href="/css/theme.css"><link rel="search" type="application/opensearchdescription+xml" href="/atom.xml" title="stardust's blog"><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="stardust's blog" type="application/atom+xml">
</head><body><div class="wrap" id="barba-wrapper"><header><h1 class="branding"><a href="/" title="stardust's blog"><img class="logo-image" src="/logo.svg" alt="logo"></a></h1><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link no-barba" href="/" target="_self">HOME</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/about" target="_self">ABOUT</a></li><li class="nav-list-item"><a class="nav-list-link no-barba" href="/archives" target="_self">ARCHIVES</a></li><li class="nav-list-item"></ul></header><div class="barba-container"><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">变量、流程控制与游标MySQL笔记</h1><div class="post-info"><a></a>2022-05-03</div><div class="post-content"><h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><p>分为系统变量和自定义变量</p>
<h2 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h2><p>全局系统变量：需要加global关键字，服务重启便重置</p>
<p>会话系统变量：需要加session关键字，不写关键字，默认会话系统变量，会话之间会话变量隔离</p>
<ul>
<li>查看系统变量</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查看所有全局变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> VARIABLES;</span><br><span class="line">#查看所有会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES;</span><br><span class="line"><span class="keyword">SHOW</span> VARIABLES;#默认会话变量</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#查看满足条件的部分全局变量</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> variables <span class="keyword">like</span> <span class="string">&#x27;admin_%&#x27;</span>;</span><br><span class="line">#查看满足条件的部分会话变量</span><br><span class="line"><span class="keyword">SHOW</span> SESSION VARIABLES <span class="keyword">like</span> <span class="string">&#x27;%char%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>查看指定的系统变量</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查看指定的全局变量</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@global</span>.max_connections;</span><br><span class="line">#查看指定的会话变量</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@session</span>.pseudo_thread_id;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="variable">@pseudo</span>_thread_id;;#默认会话变量</span><br></pre></td></tr></table></figure>

<ul>
<li>修改系统变量的值</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#修改my.ini配置文件，然后重启MySQL服务</span><br><span class="line">#使用<span class="keyword">SET</span>设置系统变量值</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@global</span>.max_connections <span class="operator">=</span> <span class="number">150</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> max_connections <span class="operator">=</span> <span class="number">150</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="variable">@session</span>.character_set_client <span class="operator">=</span> <span class="string">&#x27;gbk&#x27;</span>;</span><br><span class="line"><span class="keyword">SET</span> SESSION character_set_client <span class="operator">=</span> <span class="string">&#x27;gbk&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h2><p>分为会话用户变量和局部变量</p>
<p>会话用户变量：当前连接会话有效</p>
<p>局部变量：只在BEGIN和END语句块中使用</p>
<ul>
<li>会话用户变量</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#变量的定义</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@temp</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@temp</span> :<span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@num</span> :<span class="operator">=</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">INTO</span> <span class="variable">@num</span> <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<ul>
<li>局部变量</li>
</ul>
<p>使用DECLARE声明，写在BEGIN…END中，而且只能放在第一句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> test_var()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">#声明局部变量</span><br><span class="line"><span class="keyword">DECLARE</span> a <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> b <span class="type">INT</span>;</span><br><span class="line"><span class="keyword">DECLARE</span> emp_name <span class="type">VARCHAR</span>(<span class="number">25</span>);</span><br><span class="line"></span><br><span class="line">#赋值</span><br><span class="line"><span class="keyword">SET</span> a <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> b:<span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">SELECT</span> last_name <span class="keyword">INTO</span> emp_name <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">101</span>;</span><br><span class="line"></span><br><span class="line">#使用</span><br><span class="line"><span class="keyword">SELECT</span> a,b,emp_name;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> test_var();</span><br></pre></td></tr></table></figure>

<h1 id="程序出错的处理机制"><a href="#程序出错的处理机制" class="headerlink" title="程序出错的处理机制"></a>程序出错的处理机制</h1><p>定义条件：将要遇到的问题</p>
<p>处理程序：遇到问题时的处理方式</p>
<h2 id="定义条件"><a href="#定义条件" class="headerlink" title="定义条件"></a>定义条件</h2><p>定义条件就是给MySQL中的错误码命名</p>
<p>错误码：</p>
<ul>
<li>MySQL_error_code：数值型错误代码</li>
<li>sqlstate_value：长度为5的字符串类型错误代码</li>
<li>例如ERROR 1418(HY000)，1418是MySQL_error_code，HY000是sqlstate_value</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#定义&quot;Field_Not_Be_NULL&quot;错误名与MySQL中违反非空约束的错误类型&quot;ERROR 1048 (23000)&quot;对应</span><br><span class="line"><span class="keyword">declare</span> Field_Not_Be_NULL <span class="keyword">condition</span> <span class="keyword">for</span> <span class="number">1048</span>;</span><br><span class="line"><span class="keyword">declare</span> Field_Not_Be_NULL <span class="keyword">condition</span> <span class="keyword">for</span> <span class="keyword">sqlstate</span> <span class="string">&#x27;23000&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="定义处理程序"><a href="#定义处理程序" class="headerlink" title="定义处理程序"></a>定义处理程序</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> 处理方式 HANDLER <span class="keyword">FOR</span> 错误类型 处理语句</span><br></pre></td></tr></table></figure>

<ul>
<li>处理方式：CONTINUE&#x2F;EXIT&#x2F;UNDO（撤销，MySQL不支持）</li>
<li>错误类型：<ul>
<li>SQLSTATE ‘字符串错误码’</li>
<li>MySQL_error_code</li>
<li>错误名称</li>
<li>SQLWARNING：匹配所有以01开头的SQLSTATE错误代码</li>
<li>NOT FOUND：匹配所有以02开头的SQLSTATE错误代码</li>
<li>SQLEXCEPTION：匹配没有被SQLWARNING和NOT FOUND捕获的SQLSTATE错误代码</li>
</ul>
</li>
<li>处理语句：<ul>
<li>SET 变量 &#x3D; 值</li>
<li>BEGIN … END</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> CONTINUE HANDLER <span class="keyword">FOR</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;42S02&#x27;</span> <span class="keyword">SET</span> <span class="variable">@INFO</span> <span class="operator">=</span> <span class="string">&#x27;NO_SUCH_TABLE&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">delimiter $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> UpdateDataNoCondition()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">declare</span> continue handler <span class="keyword">for</span> <span class="number">1048</span> <span class="keyword">set</span> <span class="variable">@prc</span>_val <span class="operator">=</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">update</span> employees <span class="keyword">set</span> email <span class="operator">=</span> <span class="keyword">null</span> <span class="keyword">where</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">update</span> employees <span class="keyword">set</span> email <span class="operator">=</span> <span class="string">&#x27;abcdef&#x27;</span> <span class="keyword">where</span> last_name <span class="operator">=</span> <span class="string">&#x27;Abel&#x27;</span>;</span><br><span class="line"><span class="keyword">set</span> <span class="variable">@x</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"><span class="keyword">end</span> $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">call</span> UpdateDataNoCondition();</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@x</span>,<span class="variable">@prc</span>_val;</span><br></pre></td></tr></table></figure>

<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="分支结构之IF"><a href="#分支结构之IF" class="headerlink" title="分支结构之IF"></a>分支结构之IF</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">IF 表达式<span class="number">1</span> <span class="keyword">THEN</span> 操作<span class="number">1</span></span><br><span class="line">ELSEIF 表达式<span class="number">2</span> <span class="keyword">THEN</span> 操作<span class="number">2</span></span><br><span class="line"><span class="keyword">ELSE</span> 操作<span class="number">3</span></span><br><span class="line"><span class="keyword">END</span> IF</span><br></pre></td></tr></table></figure>

<h2 id="分支结构之CASE"><a href="#分支结构之CASE" class="headerlink" title="分支结构之CASE"></a>分支结构之CASE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CASE</span> 表达式</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">1</span> <span class="keyword">THEN</span> 结果<span class="number">1</span>或语句<span class="number">1</span>(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">WHEN</span> 值<span class="number">2</span> <span class="keyword">THEN</span> 结果<span class="number">2</span>或语句<span class="number">2</span>(如果是语句，需要加分号)</span><br><span class="line">...</span><br><span class="line"><span class="keyword">ELSE</span> 结果n或语句n(如果是语句，需要加分号)</span><br><span class="line"><span class="keyword">END</span> [<span class="keyword">CASE</span>] (如果是放在begin...end中需要加上<span class="keyword">case</span>，如果放在<span class="keyword">select</span>后面不需要)</span><br></pre></td></tr></table></figure>

<h2 id="循环结构之LOOP"><a href="#循环结构之LOOP" class="headerlink" title="循环结构之LOOP"></a>循环结构之LOOP</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> id <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">add_loop:LOOP</span><br><span class="line">	<span class="keyword">SET</span> id <span class="operator">=</span> id <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">	IF id <span class="operator">&gt;=</span> <span class="number">10</span> <span class="keyword">THEN</span> LEAVE add_loop;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> LOOP add_loop;</span><br></pre></td></tr></table></figure>

<h2 id="循环结构之WHILE"><a href="#循环结构之WHILE" class="headerlink" title="循环结构之WHILE"></a>循环结构之WHILE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> num <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">WHILE num <span class="operator">&lt;=</span> <span class="number">10</span> DO</span><br><span class="line">	<span class="keyword">SET</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> WHILE;</span><br></pre></td></tr></table></figure>

<h2 id="循环结构之REPEAT"><a href="#循环结构之REPEAT" class="headerlink" title="循环结构之REPEAT"></a>循环结构之REPEAT</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> num <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>;</span><br><span class="line">REPEAT</span><br><span class="line">	<span class="keyword">SET</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">UNTIL num <span class="operator">&gt;=</span> <span class="number">10</span>;</span><br><span class="line"><span class="keyword">END</span> REPEAT;</span><br></pre></td></tr></table></figure>

<h2 id="跳转语句之LEAVE语句"><a href="#跳转语句之LEAVE语句" class="headerlink" title="跳转语句之LEAVE语句"></a>跳转语句之LEAVE语句</h2><p>类似于break</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> leave_begin(<span class="keyword">IN</span> num <span class="type">INT</span>)</span><br><span class="line">begin_label:<span class="keyword">BEGIN</span></span><br><span class="line">if num <span class="operator">&lt;=</span> <span class="number">0</span> </span><br><span class="line"><span class="keyword">THEN</span> LEAVE begin_label;</span><br><span class="line"><span class="keyword">ELSE</span> <span class="keyword">SELECT</span> <span class="built_in">AVG</span>(salary) <span class="keyword">from</span> employees;</span><br><span class="line"><span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br></pre></td></tr></table></figure>

<h2 id="跳转语句之ITERATE语句"><a href="#跳转语句之ITERATE语句" class="headerlink" title="跳转语句之ITERATE语句"></a>跳转语句之ITERATE语句</h2><p>类似于continue，继续下一轮循环</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> num <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">loop_label:LOOP:</span><br><span class="line">	<span class="keyword">SET</span> num <span class="operator">=</span> num <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">	IF num <span class="operator">&lt;</span><span class="number">10</span></span><br><span class="line">	<span class="keyword">THEN</span> ITERATE loop_label;</span><br><span class="line">	ELSEIF num <span class="operator">&gt;</span> <span class="number">15</span></span><br><span class="line">	<span class="keyword">THEN</span> LEAVE loop_label;</span><br><span class="line">	<span class="keyword">END</span> IF;</span><br><span class="line"><span class="keyword">END</span> LOOP;</span><br></pre></td></tr></table></figure>

<h1 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h1><p>游标，类似于指针指向结果集中的一条记录，逐条读取记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> get_count_by_limit_total_salary;</span><br><span class="line"></span><br><span class="line">DELIMITER $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_count_by_limit_total_salary(<span class="keyword">IN</span> limit_total_salary <span class="keyword">DOUBLE</span>(<span class="number">25</span>,<span class="number">2</span>), <span class="keyword">OUT</span> total_count <span class="type">INT</span>)</span><br><span class="line">label:<span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> sal <span class="keyword">DOUBLE</span>(<span class="number">25</span>,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> sal_sum <span class="keyword">DOUBLE</span>(<span class="number">25</span>,<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">DECLARE</span> cnt <span class="type">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">DECLARE</span> cur <span class="keyword">CURSOR</span> <span class="keyword">FOR</span> <span class="keyword">SELECT</span> salary <span class="keyword">FROM</span> employees <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">OPEN</span> cur;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> sal;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SET</span> sal_sum <span class="operator">=</span> sal; </span><br><span class="line">	<span class="keyword">SET</span> cnt <span class="operator">=</span> <span class="number">1</span>; </span><br><span class="line"></span><br><span class="line">	WHILE sal_sum <span class="operator">&lt;</span> limit_total_salary DO</span><br><span class="line">	<span class="keyword">FETCH</span> cur <span class="keyword">INTO</span> sal;</span><br><span class="line">	<span class="keyword">SET</span> sal_sum <span class="operator">=</span> sal_sum <span class="operator">+</span> sal;</span><br><span class="line">	<span class="keyword">SET</span> cnt <span class="operator">=</span> cnt <span class="operator">+</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">END</span> WHILE;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">SET</span> total_count <span class="operator">=</span> cnt;</span><br><span class="line">	<span class="keyword">CLOSE</span> cur;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line">DELIMITER ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> <span class="variable">@limit</span>_total_salary <span class="operator">=</span><span class="number">691400.00</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> get_count_by_limit_total_salary(<span class="variable">@limit</span>_total_salary,<span class="variable">@total</span>_count);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="variable">@total</span>_count;</span><br></pre></td></tr></table></figure>

</div></article></div></main><footer><div class="paginator"><a class="next" href="/2022/05/02/4ffbade8638b/">next</a></div><div class="copyright"><p>&copy; 2022 <a href="https://stardust-sudo.github.io">stardust</a><br>Powered by <a href="https://hexo.io/" rel="noreferrer" target="_blank">Hexo</a></p></div></footer></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/barba.js/1.0.0/barba.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
    Barba.Pjax.start()
})</script></body></html>